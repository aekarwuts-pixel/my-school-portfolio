<!DOCTYPE html>
<html lang="th">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QJBKDWWT2P"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-QJBKDWWT2P');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Assessment Center - ระบบวัดและประเมินผล</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { heading: ['Prompt', 'sans-serif'], body: ['Sarabun', 'sans-serif'] },
                    colors: { 'primary': '#0071e3', 'bg-gray': '#F5F5F7' },
                    animation: { 
                        'pulse-slow': 'pulse 3s infinite',
                        'bounce-slow': 'bounce 2s infinite'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F5F5F7; font-family: 'Prompt', sans-serif; -webkit-tap-highlight-color: transparent; }
        .nav-icon { transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .active-nav .nav-icon { transform: translateY(-5px); color: #0071e3; }
        .active-nav span { color: #0071e3; font-weight: 600; }
        
        /* Quiz Card Style */
        .quiz-card { transition: all 0.3s ease; border: 1px solid rgba(0,0,0,0.05); }
        .quiz-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: #0071e3; }
        
        /* Option Button in Quiz Mode */
        .option-btn { transition: all 0.2s; border: 2px solid #e5e7eb; }
        .option-btn:hover { border-color: #0071e3; background-color: #f0f9ff; }
        .option-btn.selected { border-color: #0071e3; background-color: #0071e3; color: white; }
        .option-btn.correct { border-color: #10b981; background-color: #10b981; color: white; }
        .option-btn.wrong { border-color: #ef4444; background-color: #ef4444; color: white; }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
    </style>
</head>
<body class="pb-28 pt-20">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full bg-white/90 backdrop-blur z-40 px-4 py-3 flex justify-between items-center h-16 border-b shadow-sm transition-all duration-300">
        <div class="flex items-center gap-3 overflow-hidden">
            <a href="Main_Dashboard.html" class="w-8 h-8 rounded-full bg-gray-100 flex-shrink-0 flex items-center justify-center hover:bg-gray-200 transition text-gray-600 active:scale-95"><i class="fa-solid fa-arrow-left"></i></a>
            <div class="truncate">
                <h1 class="font-heading font-bold text-gray-800 text-lg leading-tight truncate">ระบบวัดและประเมินผล</h1>
                <p class="text-xs text-gray-500 hidden sm:block">Assessment Center</p>
            </div>
        </div>
        <button onclick="toggleAIModal()" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-3 py-1.5 rounded-full text-xs font-bold shadow hover:shadow-lg transition transform hover:scale-105 active:scale-95 flex items-center gap-1 flex-shrink-0">
            <i class="fa-solid fa-robot"></i> <span class="hidden xs:inline">AI ออกข้อสอบ</span><span class="xs:hidden">AI</span>
        </button>
    </nav>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-4">

        <!-- 1. Stats Dashboard (Responsive Grid) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6 mb-8">
            <div class="bg-white p-5 sm:p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition">
                <div>
                    <p class="text-xs text-gray-400 font-bold uppercase">ชุดข้อสอบทั้งหมด</p>
                    <h3 class="text-2xl sm:text-3xl font-bold text-gray-800 mt-1">15 <span class="text-sm font-normal text-gray-400">ชุด</span></h3>
                </div>
                <div class="w-12 h-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-xl">
                    <i class="fa-solid fa-file-circle-question"></i>
                </div>
            </div>
            
            <div class="bg-white p-5 sm:p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition">
                <div>
                    <p class="text-xs text-gray-400 font-bold uppercase">นักเรียนที่เข้าสอบแล้ว</p>
                    <h3 class="text-2xl sm:text-3xl font-bold text-green-600 mt-1">128 <span class="text-sm font-normal text-gray-400">คน</span></h3>
                </div>
                <div class="w-12 h-12 rounded-full bg-green-50 text-green-600 flex items-center justify-center text-xl">
                    <i class="fa-solid fa-users-viewfinder"></i>
                </div>
            </div>

            <div class="bg-white p-5 sm:p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between hover:shadow-md transition sm:col-span-2 md:col-span-1">
                <div>
                    <p class="text-xs text-gray-400 font-bold uppercase">คะแนนเฉลี่ยรวม</p>
                    <h3 class="text-2xl sm:text-3xl font-bold text-orange-500 mt-1">78.5%</h3>
                </div>
                <div class="w-12 h-12 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center text-xl">
                    <i class="fa-solid fa-chart-line"></i>
                </div>
            </div>
        </div>

        <!-- 2. Quiz Library (Teacher View) -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-3">
            <h2 class="text-xl font-bold text-gray-800 border-l-4 border-blue-500 pl-3">คลังข้อสอบ</h2>
            <div class="flex gap-2 w-full sm:w-auto">
                <button class="flex-1 sm:flex-none text-xs bg-white border border-gray-300 px-3 py-1.5 rounded-lg font-bold text-gray-600 hover:bg-gray-50 active:scale-95 transition">ล่าสุด</button>
                <button class="flex-1 sm:flex-none text-xs bg-white border border-gray-300 px-3 py-1.5 rounded-lg font-bold text-gray-600 hover:bg-gray-50 active:scale-95 transition">ยอดนิยม</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6" id="quiz-grid">
            
            <!-- Quiz Card 1 -->
            <div class="quiz-card bg-white rounded-2xl overflow-hidden relative group">
                <div class="h-32 bg-gradient-to-r from-blue-500 to-cyan-400 relative p-4 flex flex-col justify-between">
                    <span class="bg-white/20 backdrop-blur text-white text-[10px] px-2 py-1 rounded w-fit">วิทยาการคำนวณ</span>
                    <h3 class="text-white font-bold text-lg leading-tight">ทดสอบความรู้ Python พื้นฐาน</h3>
                </div>
                <div class="p-5">
                    <div class="flex justify-between text-xs text-gray-500 mb-4">
                        <span><i class="fa-regular fa-clock mr-1"></i> 15 นาที</span>
                        <span><i class="fa-solid fa-list-ol mr-1"></i> 10 ข้อ</span>
                        <span><i class="fa-solid fa-user-check mr-1"></i> 45 คน</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startQuizSimulation('Python พื้นฐาน')" class="flex-1 py-2 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700 transition active:scale-95 shadow-md">
                            <i class="fa-solid fa-play mr-1"></i> ลองทำข้อสอบ
                        </button>
                        <button class="w-10 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 flex items-center justify-center transition active:scale-95">
                            <i class="fa-solid fa-gear"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quiz Card 2 -->
            <div class="quiz-card bg-white rounded-2xl overflow-hidden relative group">
                <div class="h-32 bg-gradient-to-r from-purple-500 to-pink-500 relative p-4 flex flex-col justify-between">
                    <span class="bg-white/20 backdrop-blur text-white text-[10px] px-2 py-1 rounded w-fit">วิทยาศาสตร์</span>
                    <h3 class="text-white font-bold text-lg leading-tight">ระบบสุริยะจักรวาล</h3>
                </div>
                <div class="p-5">
                    <div class="flex justify-between text-xs text-gray-500 mb-4">
                        <span><i class="fa-regular fa-clock mr-1"></i> 20 นาที</span>
                        <span><i class="fa-solid fa-list-ol mr-1"></i> 20 ข้อ</span>
                        <span><i class="fa-solid fa-user-check mr-1"></i> 32 คน</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="startQuizSimulation('ระบบสุริยะ')" class="flex-1 py-2 bg-purple-600 text-white rounded-lg text-xs font-bold hover:bg-purple-700 transition active:scale-95 shadow-md">
                            <i class="fa-solid fa-play mr-1"></i> ลองทำข้อสอบ
                        </button>
                        <button class="w-10 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 flex items-center justify-center transition active:scale-95">
                            <i class="fa-solid fa-gear"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Add New -->
            <div onclick="toggleAIModal()" class="border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center text-gray-400 cursor-pointer hover:border-blue-400 hover:text-blue-500 hover:bg-blue-50/50 transition h-full min-h-[180px] active:scale-95">
                <div class="w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center mb-3 group-hover:bg-white transition"><i class="fa-solid fa-wand-magic-sparkles text-2xl"></i></div>
                <h3 class="font-heading font-bold text-sm">สร้างข้อสอบด้วย AI</h3>
            </div>

        </div>

    </div>

    <!-- 3. Quiz Taking Modal (Responsive Fullscreen on Mobile) -->
    <div id="quiz-modal" class="fixed inset-0 z-[80] hidden bg-gray-100 flex flex-col h-full w-full">
        <!-- Quiz Header -->
        <div class="bg-white px-4 py-3 shadow-sm flex justify-between items-center flex-shrink-0 safe-top-padding">
            <div class="min-w-0 pr-2">
                <h3 class="font-bold text-lg text-gray-800 truncate" id="quiz-title-display">...</h3>
                <p class="text-xs text-gray-500">ข้อที่ <span id="current-q">1</span> / <span id="total-q">5</span></p>
            </div>
            <div class="flex items-center gap-3 flex-shrink-0">
                <div class="flex items-center gap-1 text-red-500 font-mono font-bold bg-red-50 px-2 py-1 rounded-lg text-xs sm:text-sm">
                    <i class="fa-regular fa-clock"></i> 09:59
                </div>
                <button onclick="closeQuizModal()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition"><i class="fa-solid fa-xmark text-lg text-gray-600"></i></button>
            </div>
        </div>

        <!-- Quiz Body -->
        <div class="flex-1 overflow-y-auto p-4 md:p-8 flex justify-center custom-scrollbar">
            <div class="w-full max-w-2xl flex flex-col">
                
                <!-- Question Card -->
                <div class="bg-white p-6 md:p-10 rounded-3xl shadow-sm mb-6 text-center flex-1 flex flex-col justify-center">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 leading-relaxed" id="question-text">คำสั่ง print() ใน Python ใช้ทำอะไร?</h2>
                    
                    <div class="grid grid-cols-1 gap-3" id="options-container">
                        <!-- Options injected by JS -->
                    </div>
                </div>

                <div class="flex justify-between mt-auto pt-4 safe-bottom-padding">
                    <button class="text-gray-400 font-bold hover:text-gray-600 disabled:opacity-50 px-4 py-2" disabled>ก่อนหน้า</button>
                    <button onclick="nextQuestion()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition active:scale-95 flex items-center gap-2">
                        ข้อถัดไป <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>

            </div>
        </div>
    </div>

    <!-- 4. Result Modal (Score) -->
    <div id="result-modal" class="fixed inset-0 z-[90] hidden bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-md rounded-3xl p-8 text-center relative overflow-hidden shadow-2xl transform transition-all scale-100">
            <div class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-blue-500 to-transparent -z-10"></div>
            
            <div class="w-24 h-24 bg-white rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg border-4 border-blue-100 animate-bounce-slow">
                <i class="fa-solid fa-trophy text-4xl text-yellow-400"></i>
            </div>
            
            <h2 class="text-2xl font-bold text-gray-800">ยอดเยี่ยมมาก!</h2>
            <p class="text-gray-500 mb-6">คุณทำข้อสอบเสร็จสิ้นแล้ว</p>
            
            <div class="bg-gray-50 p-6 rounded-2xl mb-6 border border-gray-100">
                <p class="text-sm text-gray-500 uppercase font-bold">คะแนนของคุณ</p>
                <h1 class="text-5xl font-heading font-bold text-blue-600 my-2">4/5</h1>
                <p class="text-xs text-green-600 font-bold bg-green-100 inline-block px-3 py-1 rounded-full">ผ่านเกณฑ์ (80%)</p>
            </div>

            <button onclick="closeResultModal()" class="w-full py-3 bg-gray-900 text-white rounded-xl font-bold shadow-lg hover:bg-black transition active:scale-95">กลับสู่หน้าหลัก</button>
        </div>
    </div>

    <!-- AI Generator Modal (Responsive) -->
    <div id="ai-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-0 sm:p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="toggleAIModal()"></div>
        <div class="bg-white w-full h-full sm:h-auto sm:max-h-[85vh] sm:max-w-lg sm:rounded-2xl shadow-2xl relative z-10 flex flex-col overflow-hidden transition-all">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white flex justify-between items-center flex-shrink-0 safe-top-padding">
                <h3 class="font-heading font-bold flex items-center gap-2"><i class="fa-solid fa-robot"></i> AI Quiz Generator</h3>
                <button onclick="toggleAIModal()" class="hover:bg-white/20 rounded-full p-1"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-4 flex-1 custom-scrollbar">
                <label class="block text-sm font-bold text-gray-700 mb-2">เรื่องที่ต้องการออกข้อสอบ</label>
                <textarea id="ai-quiz-topic" rows="2" class="w-full p-3 rounded-xl border border-gray-200 bg-gray-50 text-sm focus:ring-2 focus:ring-purple-500 outline-none transition" placeholder="เช่น วิทยาการคำนวณ เรื่อง อัลกอริทึม"></textarea>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">ระดับชั้น</label>
                        <select id="ai-quiz-grade" class="w-full p-2.5 rounded-xl border border-gray-200 text-sm bg-white focus:border-purple-500 outline-none">
                            <option>ป.1</option><option>ป.2</option><option>ป.3</option>
                            <option>ป.4</option><option>ป.5</option><option>ป.6</option>
                            <option selected>ม.1</option><option>ม.2</option><option>ม.3</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">จำนวนข้อ</label>
                        <select id="ai-quiz-num" class="w-full p-2.5 rounded-xl border border-gray-200 text-sm bg-white focus:border-purple-500 outline-none">
                            <option>5 ข้อ</option><option>10 ข้อ</option><option>20 ข้อ</option>
                        </select>
                    </div>
                </div>

                <button onclick="generateQuizAI()" id="btn-gen-quiz" class="w-full bg-gray-900 text-white py-3 rounded-xl font-bold text-sm shadow hover:bg-black transition flex justify-center items-center gap-2 active:scale-95">
                    <i class="fa-solid fa-bolt text-yellow-400"></i> สร้างข้อสอบทันที
                </button>
                
                <div id="ai-quiz-result" class="text-sm text-gray-700 bg-purple-50 p-4 rounded-xl hidden border border-purple-100 prose prose-sm max-w-none mt-2"></div>
            </div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-xl border-t border-gray-200 px-4 py-2 md:hidden z-50 rounded-t-2xl shadow-[0_-5px_15px_rgba(0,0,0,0.05)] no-print pb-safe">
        <div class="relative flex justify-between items-center max-w-sm mx-auto">
            <div id="nav-pill" class="absolute top-1/2 -translate-y-1/2 h-10 w-12 bg-blue-50 rounded-xl transition-all duration-300 ease-out -z-10"></div>
            <a href="Main_Dashboard.html" class="nav-item flex flex-col items-center justify-center w-12 text-gray-400" data-index="0"><i class="fa-solid fa-house text-xl mb-1 nav-icon"></i><span class="text-[9px] font-medium">หน้าหลัก</span></a>
            <a href="LessonPlan_Manager.html" class="nav-item flex flex-col items-center justify-center w-12 text-gray-400" data-index="1"><i class="fa-solid fa-book-open text-xl mb-1 nav-icon"></i><span class="text-[9px] font-medium">แผนการ</span></a>
            <a href="Classroom_Manager.html" class="nav-item flex flex-col items-center justify-center w-12 text-gray-400" data-index="2"><i class="fa-solid fa-users text-xl mb-1 nav-icon"></i><span class="text-[9px] font-medium">ชั้นเรียน</span></a>
            <a href="Project_Manager.html" class="nav-item flex flex-col items-center justify-center w-12 text-gray-400" data-index="3"><i class="fa-solid fa-folder-open text-xl mb-1 nav-icon"></i><span class="text-[9px] font-medium">โครงการ</span></a>
            <a href="TeacherPortfolio_BentoGrid.html" class="nav-item flex flex-col items-center justify-center w-12 text-gray-400" data-index="4"><i class="fa-solid fa-user text-xl mb-1 nav-icon"></i><span class="text-[9px] font-medium">ข้อมูล</span></a>
        </div>
    </nav>

    <script>
        const apiKey = ""; 

        // Nav Logic
        function initNav() {
            const pill = document.getElementById('nav-pill');
            const activeLink = document.querySelector('.active-nav'); // No active link by default for this page, or map it if needed
            if(activeLink) {
                pill.style.left = activeLink.offsetLeft + 'px';
                pill.style.width = activeLink.offsetWidth + 'px';
            }
        }
        window.addEventListener('load', initNav); window.addEventListener('resize', initNav);

        // Quiz Logic (Simulation)
        const mockQuestions = [
            { q: "คำสั่ง print() ใน Python ใช้ทำอะไร?", options: ["รับข้อมูล", "แสดงผลข้อมูล", "คำนวณเลข", "วาดรูป"], ans: 1 },
            { q: "ตัวแปรชนิดใดใช้เก็บข้อความ?", options: ["int", "float", "string", "boolean"], ans: 2 },
            { q: "สัญลักษณ์ใดใช้คอมเมนต์ใน Python?", options: ["//", "#", "/* */", "<!-- -->"], ans: 1 },
            { q: "Loop ใดทำงานตามจำนวนรอบที่กำหนด?", options: ["for", "while", "if", "else"], ans: 0 },
            { q: "5 + 3 * 2 มีค่าเท่าไหร่?", options: ["16", "10", "11", "13"], ans: 2 }
        ];
        
        let currentQIndex = 0;
        let score = 0;

        function startQuizSimulation(title) {
            document.getElementById('quiz-title-display').textContent = title;
            document.getElementById('quiz-modal').classList.remove('hidden');
            currentQIndex = 0;
            score = 0;
            loadQuestion();
        }

        function loadQuestion() {
            if(currentQIndex >= mockQuestions.length) {
                showResult();
                return;
            }
            
            const q = mockQuestions[currentQIndex];
            document.getElementById('current-q').textContent = currentQIndex + 1;
            document.getElementById('total-q').textContent = mockQuestions.length;
            document.getElementById('question-text').textContent = q.q;
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "option-btn p-4 rounded-xl text-left font-medium text-gray-700 bg-white shadow-sm hover:shadow-md active:scale-[0.99] transition";
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(btn, idx, q.ans);
                container.appendChild(btn);
            });
        }

        function checkAnswer(btn, selectedIdx, correctIdx) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => b.disabled = true); // Disable all
            
            if(selectedIdx === correctIdx) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('wrong');
                buttons[correctIdx].classList.add('correct'); // Show correct one
            }
            
            // Auto next after 1 sec
            setTimeout(() => {
                nextQuestion();
            }, 1500);
        }

        function nextQuestion() {
            currentQIndex++;
            loadQuestion();
        }

        function closeQuizModal() {
            document.getElementById('quiz-modal').classList.add('hidden');
        }

        function showResult() {
            closeQuizModal();
            const modal = document.getElementById('result-modal');
            modal.querySelector('h1').textContent = `${score}/${mockQuestions.length}`;
            modal.classList.remove('hidden');
        }

        function closeResultModal() {
            document.getElementById('result-modal').classList.add('hidden');
        }

        // AI Quiz Logic
        function toggleAIModal() { document.getElementById('ai-modal').classList.toggle('hidden'); }

        async function generateQuizAI() {
            const topic = document.getElementById('ai-quiz-topic').value;
            const grade = document.getElementById('ai-quiz-grade').value;
            const num = document.getElementById('ai-quiz-num').value;
            const btn = document.getElementById('btn-gen-quiz');
            const res = document.getElementById('ai-quiz-result');

            if(!topic) return;

            btn.innerHTML = '<i class="fa-solid fa-spinner animate-spin"></i> กำลังสร้างข้อสอบ...';
            btn.disabled = true;
            res.classList.remove('hidden');

            const prompt = `ออกข้อสอบปรนัย (4 ตัวเลือก) วิชาคอมพิวเตอร์ เรื่อง "${topic}" สำหรับชั้น ${grade} จำนวน ${num} พร้อมเฉลยละเอียด ใช้ภาษาไทย รูปแบบ Markdown`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "Error";
                res.innerHTML = marked.parse(text);
            } catch(e) { res.textContent = "AI Error"; }

            btn.innerHTML = 'สร้างข้อสอบทันที';
            btn.disabled = false;
        }
        
        initNav();
    </script>
</body>
</html>